<div class="ai-chat-container">
  <div class="chat-header">
    <h3>
      <mat-icon>smart_toy</mat-icon>
      AI Assistant
    </h3>
    <div class="status-indicator">
      <span class="status-dot" [ngClass]="getStatusClass()"></span>
      <span class="status-text">{{ getStatusText() }}</span>
    </div>
  </div>

  <div class="chat-messages" #chatMessages>
    <div *ngFor="let message of chatHistory" class="message" [ngClass]="message.type">
      <div class="message-content">
        <div class="message-header">
          <span class="message-type">
            <mat-icon *ngIf="message.type === 'ai'">smart_toy</mat-icon>
            <mat-icon *ngIf="message.type === 'user'">person</mat-icon>
            {{ message.type === 'ai' ? 'AI Assistant' : 'You' }}
          </span>
          <span class="message-time">{{ message.timestamp | date:'shortTime' }}</span>
        </div>
        <div class="message-text">{{ message.content }}</div>
        
        <!-- Display citations if available -->
        <div *ngIf="message.citations && message.citations.length > 0" class="message-citations">
          <strong>Sources:</strong>
          <span *ngFor="let citation of message.citations" class="citation">{{ citation }}</span>
        </div>
        
        <!-- Display follow-up suggestion if available -->
        <div *ngIf="message.followUp" class="message-followup">
          <em>{{ message.followUp }}</em>
        </div>
      </div>
    </div>
    
    <div *ngIf="isLoading" class="message ai">
      <div class="message-content">
        <div class="message-header">
          <span class="message-type">
            <mat-icon>smart_toy</mat-icon>
            AI Assistant
          </span>
        </div>
        <div class="typing-indicator">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </div>
    </div>
  </div>

  <div class="chat-input">
    <mat-form-field appearance="outline" class="question-input">
      <mat-label>Ask me about your notes...</mat-label>
      <input matInput 
             [formControl]="questionControl" 
             placeholder="e.g., What projects am I working on?"
             (keyup.enter)="askQuestion()">
      <mat-icon matSuffix>question_answer</mat-icon>
    </mat-form-field>
    
    <div class="input-actions">
      <button mat-raised-button 
              color="primary" 
              [disabled]="!questionControl.value?.trim() || isLoading"
              (click)="askQuestion()">
        <mat-icon>send</mat-icon>
        Ask AI
      </button>
      
      <button mat-button 
              color="warn" 
              [disabled]="chatHistory.length <= 1"
              (click)="clearChat()">
        <mat-icon>clear_all</mat-icon>
        Clear Chat
      </button>
      
      <button mat-button 
              color="accent" 
              [disabled]="!currentCursor"
              (click)="showMore()">
        <mat-icon>more_horiz</mat-icon>
        Show More
      </button>
    </div>
  </div>

  <div class="chat-info">
    <p>
      <mat-icon>info</mat-icon>
      This AI assistant is powered by Llama3 and can search through your knowledge base.
      Ask questions and use "Show More" to get additional information.
    </p>
  </div>
</div>
